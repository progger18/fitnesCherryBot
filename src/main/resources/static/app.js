let tg = window.Telegram.WebApp;

// Инициализация приложения
tg.expand();
tg.enableClosingConfirmation();

// Функция для расчета ИМТ
function calculateBMI() {
    const weight = parseFloat(document.getElementById('weight').value);
    const height = parseFloat(document.getElementById('height').value);

    if (!weight || !height) {
        showResult('bmiResult', 'Пожалуйста, введите вес и рост');
        return;
    }

    const heightInMeters = height / 100;
    const bmi = weight / (heightInMeters * heightInMeters);
    let category;
    let recommendations;

    if (bmi < 18.5) {
        category = "Недостаточный вес";
        recommendations = "• Увеличьте калорийность рациона\n• Добавьте силовые тренировки\n• Питайтесь чаще";
    } else if (bmi < 25) {
        category = "Нормальный вес";
        recommendations = "• Поддерживайте текущий режим\n• Регулярно тренируйтесь\n• Сбалансированно питайтесь";
    } else {
        category = "Избыточный вес";
        recommendations = "• Создайте дефицит калорий\n• Добавьте кардио тренировки\n• Уменьшите потребление простых углеводов";
    }

    const result = `Ваш ИМТ: ${bmi.toFixed(1)}\nКатегория: ${category}\n\nРекомендации:\n${recommendations}`;
    showResult('bmiResult', result);
}

// Функция для получения плана тренировок
function getTrainingPlan() {
    const level = document.getElementById('trainingLevel').value;
    let plan;

    switch (level) {
        case 'beginner':
            plan = "План для начинающих:\n\n" +
                   "Понедельник (Ноги и ягодицы):\n" +
                   "1. Разминка (10 минут)\n" +
                   "2. Приседания: 3 подхода по 10 повторений\n" +
                   "3. Выпады: 3 подхода по 8 повторений на каждую ногу\n" +
                   "4. Подъемы на носки: 3 подхода по 15 повторений\n" +
                   "5. Планка: 3 подхода по 20 секунд\n" +
                   "6. Растяжка (10 минут)\n\n" +
                   "Среда (Верхняя часть тела):\n" +
                   "1. Разминка (10 минут)\n" +
                   "2. Отжимания: 3 подхода по 5 повторений\n" +
                   "3. Тяга гантелей: 3 подхода по 10 повторений\n" +
                   "4. Подъемы рук: 3 подхода по 12 повторений\n" +
                   "5. Планка: 3 подхода по 20 секунд\n" +
                   "6. Растяжка (10 минут)\n\n" +
                   "Пятница (Кардио и кор):\n" +
                   "1. Разминка (10 минут)\n" +
                   "2. Прыжки на скакалке: 3 подхода по 1 минуте\n" +
                   "3. Берпи: 3 подхода по 5 повторений\n" +
                   "4. Скручивания: 3 подхода по 12 повторений\n" +
                   "5. Планка: 3 подхода по 20 секунд\n" +
                   "6. Растяжка (10 минут)\n\n" +
                   "Рекомендации:\n" +
                   "• Отдых между подходами: 60-90 секунд\n" +
                   "• Пейте воду во время тренировки\n" +
                   "• Следите за техникой выполнения\n" +
                   "• Увеличивайте нагрузку постепенно";
            break;
        case 'intermediate':
            plan = "План для среднего уровня:\n\n" +
                   "Понедельник (Ноги):\n" +
                   "1. Разминка (15 минут)\n" +
                   "2. Приседания со штангой: 4 подхода по 12 повторений\n" +
                   "3. Выпады с гантелями: 4 подхода по 10 повторений\n" +
                   "4. Жим ногами: 4 подхода по 12 повторений\n" +
                   "5. Подъемы на носки: 4 подхода по 15 повторений\n" +
                   "6. Планка: 4 подхода по 45 секунд\n" +
                   "7. Растяжка (15 минут)\n\n" +
                   "Среда (Грудь и трицепс):\n" +
                   "1. Разминка (15 минут)\n" +
                   "2. Жим штанги лежа: 4 подхода по 10 повторений\n" +
                   "3. Разведение гантелей: 4 подхода по 12 повторений\n" +
                   "4. Отжимания на брусьях: 4 подхода по 10 повторений\n" +
                   "5. Разгибания рук: 4 подхода по 12 повторений\n" +
                   "6. Планка: 4 подхода по 45 секунд\n" +
                   "7. Растяжка (15 минут)\n\n" +
                   "Пятница (Спина и бицепс):\n" +
                   "1. Разминка (15 минут)\n" +
                   "2. Подтягивания: 4 подхода по 8 повторений\n" +
                   "3. Тяга верхнего блока: 4 подхода по 12 повторений\n" +
                   "4. Тяга гантели в наклоне: 4 подхода по 10 повторений\n" +
                   "5. Сгибания рук: 4 подхода по 12 повторений\n" +
                   "6. Планка: 4 подхода по 45 секунд\n" +
                   "7. Растяжка (15 минут)\n\n" +
                   "Рекомендации:\n" +
                   "• Отдых между подходами: 45-60 секунд\n" +
                   "• Суперсеты для экономии времени\n" +
                   "• Контролируйте темп выполнения\n" +
                   "• Добавьте кардио 2-3 раза в неделю";
            break;
        case 'advanced':
            plan = "План для продвинутых:\n\n" +
                   "Понедельник (Ноги):\n" +
                   "1. Разминка (20 минут)\n" +
                   "2. Приседания со штангой: 5 подходов по 8 повторений\n" +
                   "3. Румынская тяга: 5 подходов по 8 повторений\n" +
                   "4. Выпады с гантелями: 4 подхода по 10 повторений\n" +
                   "5. Жим ногами: 4 подхода по 10 повторений\n" +
                   "6. Подъемы на носки: 4 подхода по 15 повторений\n" +
                   "7. Планка: 5 подходов по 60 секунд\n" +
                   "8. Растяжка (20 минут)\n\n" +
                   "Вторник (Грудь и трицепс):\n" +
                   "1. Разминка (20 минут)\n" +
                   "2. Жим штанги лежа: 5 подходов по 6-8 повторений\n" +
                   "3. Жим гантелей на наклонной скамье: 4 подхода по 8 повторений\n" +
                   "4. Разведение гантелей: 4 подхода по 12 повторений\n" +
                   "5. Отжимания на брусьях: 4 подхода по 10 повторений\n" +
                   "6. Разгибания рук: 4 подхода по 12 повторений\n" +
                   "7. Планка: 5 подходов по 60 секунд\n" +
                   "8. Растяжка (20 минут)\n\n" +
                   "Четверг (Спина и бицепс):\n" +
                   "1. Разминка (20 минут)\n" +
                   "2. Становая тяга: 5 подходов по 6 повторений\n" +
                   "3. Подтягивания: 4 подхода по 8-10 повторений\n" +
                   "4. Тяга верхнего блока: 4 подхода по 10 повторений\n" +
                   "5. Тяга гантели в наклоне: 4 подхода по 10 повторений\n" +
                   "6. Сгибания рук: 4 подхода по 12 повторений\n" +
                   "7. Планка: 5 подходов по 60 секунд\n" +
                   "8. Растяжка (20 минут)\n\n" +
                   "Пятница (Плечи и руки):\n" +
                   "1. Разминка (20 минут)\n" +
                   "2. Жим штанги над головой: 5 подходов по 8 повторений\n" +
                   "3. Разведение гантелей: 4 подхода по 12 повторений\n" +
                   "4. Тяга к подбородку: 4 подхода по 10 повторений\n" +
                   "5. Сгибания рук: 4 подхода по 10 повторений\n" +
                   "6. Разгибания рук: 4 подхода по 12 повторений\n" +
                   "7. Планка: 5 подходов по 60 секунд\n" +
                   "8. Растяжка (20 минут)\n\n" +
                   "Рекомендации:\n" +
                   "• Отдых между подходами: 30-45 секунд\n" +
                   "• Используйте дроп-сеты и суперсеты\n" +
                   "• Добавьте кардио 3-4 раза в неделю\n" +
                   "• Следите за восстановлением";
            break;
    }

    showResult('trainingPlan', plan);
}

// Функция для получения плана питания
function getNutritionPlan() {
    const plan = "Рекомендуемые продукты и их калорийность:\n\n" +
                 "🥩 Белки:\n" +
                 "• Куриная грудка (100г) - 165 ккал, 31г белка\n" +
                 "• Лосось (100г) - 208 ккал, 22г белка\n" +
                 "• Тунец (100г) - 144 ккал, 23г белка\n" +
                 "• Яйца (1 шт) - 70 ккал, 6г белка\n" +
                 "• Творог 5% (100г) - 121 ккал, 17г белка\n\n" +
                 "🌾 Углеводы:\n" +
                 "• Коричневый рис (100г) - 112 ккал, 2.6г белка\n" +
                 "• Овсянка (100г) - 68 ккал, 2.5г белка\n" +
                 "• Киноа (100г) - 120 ккал, 4.4г белка\n" +
                 "• Сладкий картофель (100г) - 86 ккал, 1.6г белка\n" +
                 "• Гречка (100г) - 110 ккал, 4г белка\n\n" +
                 "🥑 Жиры:\n" +
                 "• Авокадо (100г) - 160 ккал, 2г белка\n" +
                 "• Миндаль (100г) - 576 ккал, 21г белка\n" +
                 "• Оливковое масло (1 ст.л) - 120 ккал\n" +
                 "• Жирная рыба (100г) - 208 ккал, 22г белка\n" +
                 "• Семена чиа (100г) - 486 ккал, 17г белка\n\n" +
                 "🥬 Овощи:\n" +
                 "• Брокколи (100г) - 34 ккал, 2.8г белка\n" +
                 "• Шпинат (100г) - 23 ккал, 2.9г белка\n" +
                 "• Болгарский перец (100г) - 31 ккал, 1г белка\n" +
                 "• Цукини (100г) - 17 ккал, 1.2г белка\n" +
                 "• Брюссельская капуста (100г) - 43 ккал, 3.4г белка\n\n" +
                 "Рекомендации по питанию:\n" +
                 "• Белки: 1.6-2.2г на кг веса\n" +
                 "• Жиры: 0.8-1г на кг веса\n" +
                 "• Углеводы: 3-5г на кг веса\n" +
                 "• Пейте 2-3 литра воды в день\n" +
                 "• Питайтесь 4-6 раз в день\n" +
                 "• Учитывайте время приема пищи относительно тренировок";

    showResult('nutritionPlan', plan);
}

// Функция для получения мотивационной цитаты
function getMotivationalQuote() {
    const quotes = [
        "Твой единственный предел - это ты сам.",
        "Каждый день - это новая возможность стать лучше.",
        "Сила не в мышцах, а в силе воли.",
        "Тяжело в тренировке - легко в жизни.",
        "Не останавливайся, когда устал. Останавливайся, когда закончил."
    ];
    const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
    showResult('motivationalQuote', "💪 " + randomQuote);
}

// Функция для расчета суточной нормы калорий
function calculateDailyCalories() {
    const weight = parseFloat(document.getElementById('weight').value);
    const height = parseFloat(document.getElementById('height').value);
    const age = parseInt(document.getElementById('age').value);
    const activityLevel = document.getElementById('activityLevel').value;
    const goal = document.getElementById('goal').value;

    if (!weight || !height || !age) {
        showResult('caloriesResult', 'Пожалуйста, заполните все поля');
        return;
    }

    // Расчет базового обмена веществ (формула Миффлина-Сан Жеора)
    let bmr = 10 * weight + 6.25 * height - 5 * age + 5;

    // Коэффициент активности
    let activityMultiplier;
    switch (activityLevel) {
        case 'sedentary':
            activityMultiplier = 1.2;
            break;
        case 'light':
            activityMultiplier = 1.375;
            break;
        case 'moderate':
            activityMultiplier = 1.55;
            break;
        case 'active':
            activityMultiplier = 1.725;
            break;
        case 'very_active':
            activityMultiplier = 1.9;
            break;
    }

    // Расчет суточной нормы калорий
    let tdee = bmr * activityMultiplier;

    // Корректировка в зависимости от цели
    switch (goal) {
        case 'lose':
            tdee -= 500; // Дефицит калорий для похудения
            break;
        case 'maintain':
            // Оставляем как есть
            break;
        case 'gain':
            tdee += 500; // Профицит калорий для набора массы
            break;
    }

    // Расчет макронутриентов
    const protein = Math.round(weight * 2); // 2г белка на кг веса
    const fat = Math.round(weight * 0.8); // 0.8г жиров на кг веса
    const carbs = Math.round((tdee - (protein * 4 + fat * 9)) / 4); // Оставшиеся калории из углеводов

    const result = `Ваша суточная норма калорий: ${Math.round(tdee)} ккал\n\n` +
                  `Рекомендуемое распределение макронутриентов:\n` +
                  `• Белки: ${protein}г (${protein * 4} ккал)\n` +
                  `• Жиры: ${fat}г (${fat * 9} ккал)\n` +
                  `• Углеводы: ${carbs}г (${carbs * 4} ккал)\n\n` +
                  `Рекомендации:\n` +
                  `• Питайтесь 4-6 раз в день\n` +
                  `• Пейте 2-3 литра воды\n` +
                  `• Следите за качеством продуктов\n` +
                  `• Ведите дневник питания`;

    showResult('caloriesResult', result);
}

// Вспомогательная функция для отображения результатов
function showResult(elementId, text) {
    const element = document.getElementById(elementId);
    element.innerHTML = text.replace(/\n/g, '<br>');
    element.style.display = 'block';
} 