let tg = window.Telegram.WebApp;

// Инициализация приложения
tg.expand();
tg.enableClosingConfirmation();

// Функция для расчета ИМТ
function calculateBMI() {
    const weight = parseFloat(document.getElementById('weight').value);
    const height = parseFloat(document.getElementById('height').value);

    if (!weight || !height) {
        showResult('bmiResult', 'Пожалуйста, введите вес и рост');
        return;
    }

    const heightInMeters = height / 100;
    const bmi = weight / (heightInMeters * heightInMeters);
    let category;
    let recommendations;

    if (bmi < 18.5) {
        category = "Недостаточный вес";
        recommendations = "• Увеличьте калорийность рациона\n• Добавьте силовые тренировки\n• Питайтесь чаще";
    } else if (bmi < 25) {
        category = "Нормальный вес";
        recommendations = "• Поддерживайте текущий режим\n• Регулярно тренируйтесь\n• Сбалансированно питайтесь";
    } else {
        category = "Избыточный вес";
        recommendations = "• Создайте дефицит калорий\n• Добавьте кардио тренировки\n• Уменьшите потребление простых углеводов";
    }

    const result = `Ваш ИМТ: ${bmi.toFixed(1)}\nКатегория: ${category}\n\nРекомендации:\n${recommendations}`;
    showResult('bmiResult', result);
}

// Функция для получения плана тренировок
function getTrainingPlan() {
    const level = document.getElementById('trainingLevel').value;
    let plan;

    switch (level) {
        case 'beginner':
            plan = "План для начинающих:\n\n" +
                   "Понедельник (Ноги и ягодицы):\n" +
                   "1. Разминка (10 минут):\n" +
                   "   • Ходьба на месте\n" +
                   "   • Вращения суставов\n" +
                   "   • Легкие прыжки\n" +
                   "2. Приседания: 3 подхода по 10 повторений\n" +
                   "   • Ноги на ширине плеч\n" +
                   "   • Колени не выходят за носки\n" +
                   "   • Спина прямая\n" +
                   "3. Выпады: 3 подхода по 8 повторений на каждую ногу\n" +
                   "   • Шаг вперед\n" +
                   "   • Колено задней ноги почти касается пола\n" +
                   "4. Подъемы на носки: 3 подхода по 15 повторений\n" +
                   "   • Можно выполнять на ступеньке\n" +
                   "5. Планка: 3 подхода по 20 секунд\n" +
                   "   • Локти под плечами\n" +
                   "   • Тело прямое\n" +
                   "6. Растяжка (10 минут)\n\n" +
                   "Среда (Верхняя часть тела):\n" +
                   "1. Разминка (10 минут)\n" +
                   "2. Отжимания: 3 подхода по 5 повторений\n" +
                   "   • Можно выполнять с колен\n" +
                   "   • Локти близко к телу\n" +
                   "3. Тяга гантелей: 3 подхода по 10 повторений\n" +
                   "   • Наклон вперед\n" +
                   "   • Спина прямая\n" +
                   "4. Подъемы рук: 3 подхода по 12 повторений\n" +
                   "   • Можно использовать бутылки с водой\n" +
                   "5. Планка: 3 подхода по 20 секунд\n" +
                   "6. Растяжка (10 минут)\n\n" +
                   "Пятница (Кардио и кор):\n" +
                   "1. Разминка (10 минут)\n" +
                   "2. Прыжки на скакалке: 3 подхода по 1 минуте\n" +
                   "   • Можно заменить на прыжки на месте\n" +
                   "3. Берпи: 3 подхода по 5 повторений\n" +
                   "   • Можно упростить, убрав прыжок\n" +
                   "4. Скручивания: 3 подхода по 12 повторений\n" +
                   "   • Руки за головой\n" +
                   "   • Подбородок к груди\n" +
                   "5. Планка: 3 подхода по 20 секунд\n" +
                   "6. Растяжка (10 минут)\n\n" +
                   "Рекомендации:\n" +
                   "• Отдых между подходами: 60-90 секунд\n" +
                   "• Пейте воду во время тренировки\n" +
                   "• Следите за техникой выполнения\n" +
                   "• Увеличивайте нагрузку постепенно";
            break;
        case 'intermediate':
            plan = "План для среднего уровня:\n\n" +
                   "Понедельник (Ноги):\n" +
                   "1. Разминка (15 минут):\n" +
                   "   • Легкий бег\n" +
                   "   • Динамическая растяжка\n" +
                   "   • Разогрев суставов\n" +
                   "2. Приседания со штангой: 4 подхода по 12 повторений\n" +
                   "   • Вес: 60-70% от максимума\n" +
                   "   • Глубина: параллельно полу\n" +
                   "3. Выпады с гантелями: 4 подхода по 10 повторений\n" +
                   "   • Вес гантелей: 8-12 кг\n" +
                   "   • Шаг вперед и назад\n" +
                   "4. Жим ногами: 4 подхода по 12 повторений\n" +
                   "   • Разные постановки ног\n" +
                   "5. Подъемы на носки: 4 подхода по 15 повторений\n" +
                   "   • С дополнительным весом\n" +
                   "6. Планка: 4 подхода по 45 секунд\n" +
                   "7. Растяжка (15 минут)\n\n" +
                   "Среда (Грудь и трицепс):\n" +
                   "1. Разминка (15 минут)\n" +
                   "2. Жим штанги лежа: 4 подхода по 10 повторений\n" +
                   "   • Разные хваты\n" +
                   "3. Разведение гантелей: 4 подхода по 12 повторений\n" +
                   "   • Лежа на скамье\n" +
                   "4. Отжимания на брусьях: 4 подхода по 10 повторений\n" +
                   "   • С дополнительным весом\n" +
                   "5. Разгибания рук: 4 подхода по 12 повторений\n" +
                   "6. Планка: 4 подхода по 45 секунд\n" +
                   "7. Растяжка (15 минут)\n\n" +
                   "Пятница (Спина и бицепс):\n" +
                   "1. Разминка (15 минут)\n" +
                   "2. Подтягивания: 4 подхода по 8 повторений\n" +
                   "   • Разные хваты\n" +
                   "3. Тяга верхнего блока: 4 подхода по 12 повторений\n" +
                   "   • К груди и за голову\n" +
                   "4. Тяга гантели в наклоне: 4 подхода по 10 повторений\n" +
                   "5. Сгибания рук: 4 подхода по 12 повторений\n" +
                   "6. Планка: 4 подхода по 45 секунд\n" +
                   "7. Растяжка (15 минут)\n\n" +
                   "Рекомендации:\n" +
                   "• Отдых между подходами: 45-60 секунд\n" +
                   "• Суперсеты для экономии времени\n" +
                   "• Контролируйте темп выполнения\n" +
                   "• Добавьте кардио 2-3 раза в неделю";
            break;
        case 'advanced':
            plan = "План для продвинутых:\n\n" +
                   "Понедельник (Ноги):\n" +
                   "1. Разминка (20 минут):\n" +
                   "   • Кардио 10 минут\n" +
                   "   • Динамическая растяжка\n" +
                   "   • Разогрев суставов\n" +
                   "2. Приседания со штангой: 5 подходов по 8 повторений\n" +
                   "   • Вес: 75-85% от максимума\n" +
                   "   • Глубина: ниже параллели\n" +
                   "3. Румынская тяга: 5 подходов по 8 повторений\n" +
                   "   • Вес: 70-80% от максимума\n" +
                   "   • Растяжка задней поверхности бедра\n" +
                   "4. Выпады с гантелями: 4 подхода по 10 повторений\n" +
                   "   • Вес гантелей: 12-16 кг\n" +
                   "   • Ходьба выпадами\n" +
                   "5. Жим ногами: 4 подхода по 10 повторений\n" +
                   "   • Суперсет с разгибаниями ног\n" +
                   "6. Подъемы на носки: 4 подхода по 15 повторений\n" +
                   "   • С максимальным весом\n" +
                   "7. Планка: 5 подходов по 60 секунд\n" +
                   "8. Растяжка (20 минут)\n\n" +
                   "Вторник (Грудь и трицепс):\n" +
                   "1. Разминка (20 минут)\n" +
                   "2. Жим штанги лежа: 5 подходов по 6-8 повторений\n" +
                   "   • Вес: 80-90% от максимума\n" +
                   "3. Жим гантелей на наклонной скамье: 4 подхода по 8 повторений\n" +
                   "   • Угол 30-45 градусов\n" +
                   "4. Разведение гантелей: 4 подхода по 12 повторений\n" +
                   "   • Суперсет с отжиманиями\n" +
                   "5. Отжимания на брусьях: 4 подхода по 10 повторений\n" +
                   "   • С дополнительным весом\n" +
                   "6. Разгибания рук: 4 подхода по 12 повторений\n" +
                   "   • Разные хваты\n" +
                   "7. Планка: 5 подходов по 60 секунд\n" +
                   "8. Растяжка (20 минут)\n\n" +
                   "Четверг (Спина и бицепс):\n" +
                   "1. Разминка (20 минут)\n" +
                   "2. Становая тяга: 5 подходов по 6 повторений\n" +
                   "   • Вес: 80-90% от максимума\n" +
                   "3. Подтягивания: 4 подхода по 8-10 повторений\n" +
                   "   • С дополнительным весом\n" +
                   "4. Тяга верхнего блока: 4 подхода по 10 повторений\n" +
                   "   • Суперсет с тягой в наклоне\n" +
                   "5. Тяга гантели в наклоне: 4 подхода по 10 повторений\n" +
                   "6. Сгибания рук: 4 подхода по 12 повторений\n" +
                   "   • Разные хваты и углы\n" +
                   "7. Планка: 5 подходов по 60 секунд\n" +
                   "8. Растяжка (20 минут)\n\n" +
                   "Пятница (Плечи и руки):\n" +
                   "1. Разминка (20 минут)\n" +
                   "2. Жим штанги над головой: 5 подходов по 8 повторений\n" +
                   "   • Вес: 75-85% от максимума\n" +
                   "3. Разведение гантелей: 4 подхода по 12 повторений\n" +
                   "   • В наклоне и стоя\n" +
                   "4. Тяга к подбородку: 4 подхода по 10 повторений\n" +
                   "   • Узкий хват\n" +
                   "5. Сгибания рук: 4 подхода по 10 повторений\n" +
                   "   • Суперсет с разгибаниями\n" +
                   "6. Разгибания рук: 4 подхода по 12 повторений\n" +
                   "7. Планка: 5 подходов по 60 секунд\n" +
                   "8. Растяжка (20 минут)\n\n" +
                   "Рекомендации:\n" +
                   "• Отдых между подходами: 30-45 секунд\n" +
                   "• Используйте дроп-сеты и суперсеты\n" +
                   "• Добавьте кардио 3-4 раза в неделю\n" +
                   "• Следите за восстановлением";
            break;
    }

    showResult('trainingPlan', plan);
}

// Функция для получения плана питания
function getNutritionPlan() {
    const plan = "Рекомендуемые продукты и их калорийность:\n\n" +
                 "🥩 Белки:\n" +
                 "• Куриная грудка (100г) - 165 ккал, 31г белка, 3.6г жиров\n" +
                 "• Лосось (100г) - 208 ккал, 22г белка, 13г жиров\n" +
                 "• Тунец (100г) - 144 ккал, 23г белка, 4.9г жиров\n" +
                 "• Яйца (1 шт) - 70 ккал, 6г белка, 5г жиров\n" +
                 "• Творог 5% (100г) - 121 ккал, 17г белка, 5г жиров\n" +
                 "• Говядина (100г) - 250 ккал, 26г белка, 17г жиров\n" +
                 "• Индейка (100г) - 157 ккал, 29г белка, 3.6г жиров\n\n" +
                 "🌾 Углеводы:\n" +
                 "• Коричневый рис (100г) - 112 ккал, 2.6г белка, 0.9г жиров, 23.5г углеводов\n" +
                 "• Овсянка (100г) - 68 ккал, 2.5г белка, 1.5г жиров, 12г углеводов\n" +
                 "• Киноа (100г) - 120 ккал, 4.4г белка, 1.9г жиров, 21.3г углеводов\n" +
                 "• Сладкий картофель (100г) - 86 ккал, 1.6г белка, 0.1г жиров, 20г углеводов\n" +
                 "• Гречка (100г) - 110 ккал, 4г белка, 1г жиров, 21г углеводов\n" +
                 "• Цельнозерновой хлеб (100г) - 247 ккал, 9г белка, 3.2г жиров, 41г углеводов\n" +
                 "• Банан (1 шт) - 105 ккал, 1.3г белка, 0.3г жиров, 27г углеводов\n\n" +
                 "🥑 Жиры:\n" +
                 "• Авокадо (100г) - 160 ккал, 2г белка, 14.7г жиров\n" +
                 "• Миндаль (100г) - 576 ккал, 21г белка, 49.9г жиров\n" +
                 "• Оливковое масло (1 ст.л) - 120 ккал, 13.5г жиров\n" +
                 "• Жирная рыба (100г) - 208 ккал, 22г белка, 13г жиров\n" +
                 "• Семена чиа (100г) - 486 ккал, 17г белка, 30.7г жиров\n" +
                 "• Грецкие орехи (100г) - 654 ккал, 15.2г белка, 65.2г жиров\n" +
                 "• Арахисовая паста (100г) - 588 ккал, 25г белка, 50г жиров\n\n" +
                 "🥬 Овощи:\n" +
                 "• Брокколи (100г) - 34 ккал, 2.8г белка, 0.4г жиров, 6.6г углеводов\n" +
                 "• Шпинат (100г) - 23 ккал, 2.9г белка, 0.4г жиров, 3.6г углеводов\n" +
                 "• Болгарский перец (100г) - 31 ккал, 1г белка, 0.3г жиров, 6г углеводов\n" +
                 "• Цукини (100г) - 17 ккал, 1.2г белка, 0.3г жиров, 3.1г углеводов\n" +
                 "• Брюссельская капуста (100г) - 43 ккал, 3.4г белка, 0.3г жиров, 8.9г углеводов\n" +
                 "• Морковь (100г) - 41 ккал, 0.9г белка, 0.2г жиров, 9.6г углеводов\n" +
                 "• Помидоры (100г) - 18 ккал, 0.9г белка, 0.2г жиров, 3.9г углеводов\n\n" +
                 "Рекомендации по питанию:\n" +
                 "• Белки: 1.6-2.2г на кг веса\n" +
                 "• Жиры: 0.8-1г на кг веса\n" +
                 "• Углеводы: 3-5г на кг веса\n" +
                 "• Пейте 2-3 литра воды в день\n" +
                 "• Питайтесь 4-6 раз в день\n" +
                 "• Учитывайте время приема пищи относительно тренировок";

    showResult('nutritionPlan', plan);
}

// Функция для получения мотивационной цитаты
function getMotivationalQuote() {
    const quotes = [
        "Твой единственный предел - это ты сам.",
        "Каждый день - это новая возможность стать лучше.",
        "Сила не в мышцах, а в силе воли.",
        "Тяжело в тренировке - легко в жизни.",
        "Не останавливайся, когда устал. Останавливайся, когда закончил.",
        "Твое тело может вынести почти все. Твоя задача - убедить в этом свой разум.",
        "Успех - это сумма небольших усилий, повторяемых изо дня в день.",
        "Если это не бросает тебе вызов, это не меняет тебя.",
        "Тренировка - это не наказание, а награда за то, что ты можешь это делать.",
        "Твое будущее создается тем, что ты делаешь сегодня.",
        "Не бойся быть сильным. Кто-то где-то в это время тренируется, чтобы победить тебя.",
        "Боль, которую ты чувствуешь сегодня, станет силой, которую ты почувствуешь завтра.",
        "Тренировка - это не просто физическая активность, это образ жизни.",
        "Твое тело может все. Нужно только убедить в этом свой разум.",
        "Каждая тренировка - это шаг к лучшей версии себя."
    ];
    const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
    showResult('motivationalQuote', "💪 " + randomQuote);
}

// Функция для расчета суточной нормы калорий
function calculateDailyCalories() {
    const weight = parseFloat(document.getElementById('weight').value);
    const height = parseFloat(document.getElementById('height').value);
    const age = parseInt(document.getElementById('age').value);
    const activityLevel = document.getElementById('activityLevel').value;
    const goal = document.getElementById('goal').value;

    if (!weight || !height || !age) {
        showResult('caloriesResult', 'Пожалуйста, заполните все поля');
        return;
    }

    // Расчет базового обмена веществ (формула Миффлина-Сан Жеора)
    let bmr = 10 * weight + 6.25 * height - 5 * age + 5;

    // Коэффициент активности
    let activityMultiplier;
    switch (activityLevel) {
        case 'sedentary':
            activityMultiplier = 1.2;
            break;
        case 'light':
            activityMultiplier = 1.375;
            break;
        case 'moderate':
            activityMultiplier = 1.55;
            break;
        case 'active':
            activityMultiplier = 1.725;
            break;
        case 'very_active':
            activityMultiplier = 1.9;
            break;
    }

    // Расчет суточной нормы калорий
    let tdee = bmr * activityMultiplier;

    // Корректировка в зависимости от цели
    switch (goal) {
        case 'lose':
            tdee -= 500; // Дефицит калорий для похудения
            break;
        case 'maintain':
            // Оставляем как есть
            break;
        case 'gain':
            tdee += 500; // Профицит калорий для набора массы
            break;
    }

    // Расчет макронутриентов
    const protein = Math.round(weight * 2); // 2г белка на кг веса
    const fat = Math.round(weight * 0.8); // 0.8г жиров на кг веса
    const carbs = Math.round((tdee - (protein * 4 + fat * 9)) / 4); // Оставшиеся калории из углеводов

    const result = `Ваша суточная норма калорий: ${Math.round(tdee)} ккал\n\n` +
                  `Рекомендуемое распределение макронутриентов:\n` +
                  `• Белки: ${protein}г (${protein * 4} ккал)\n` +
                  `• Жиры: ${fat}г (${fat * 9} ккал)\n` +
                  `• Углеводы: ${carbs}г (${carbs * 4} ккал)\n\n` +
                  `Рекомендации:\n` +
                  `• Питайтесь 4-6 раз в день\n` +
                  `• Пейте 2-3 литра воды\n` +
                  `• Следите за качеством продуктов\n` +
                  `• Ведите дневник питания`;

    showResult('caloriesResult', result);
}

// Вспомогательная функция для отображения результатов
function showResult(elementId, text) {
    const element = document.getElementById(elementId);
    element.innerHTML = text.replace(/\n/g, '<br>');
    element.style.display = 'block';
} 